Python中字符串有一个比较特殊令我初学时头疼的编码问题。

python3的字符串使用Unicode,直接支持多语言。但是我们没什么特殊要求情况下，一般用UFT-8。

### 1、编码

由于计算机是由美国发明的，因此，最早只有127个字母被编码到计算机里，也就是大小写字母、数字和一些符号，这个编码表被成为ASCII编码，比如大写字母A的编码是65，小写字母z的编码是122。

显然，ASCII编码要处理中文显然一个字节是不够的，至少得要两个字节，所以，中国制定了GB2312编码，把中文编码进去。全世界上百种语言，各国有各国的标准，不可避免会出现冲突，结果就是，在多语言混合文本中，显示会有乱码。因此,Unicode应运而生。Unicode把所有语言都统一到一套编码里了。

ASCII需要一个字节，而Unicode通常需要两个字节（偏僻字有可能需要4个字节）。当文本基本上全是英文的话，Unicode需要比ASCII多一倍的存储空间，因而在存储和传输上十分不划算。

于是，本着节约的精神，又出现了把Unicode编码转化为“可变长编码”的UTF\_8编码。UTF-8编码把一个Unicode字符根据不同的数字大小编码成1-6个字节，常用的英文字母被编码成1个字节，汉字通常被编码成3个字节，只有特别生僻的才会被编码成4-6个字节。如果你要传输的文本包含大量的英文字符，用UTF-8编码就会节约大量的空间：

![](/assets/1.PNG)现在弄清了ASCII、Unicode和UTF-8编码之间的关系，我们就可以总结一下现在计算机系统通用的字符编码工作方式：

在计算机内存中，统一使用Unicode编码，当需要保存到硬盘或需要传输时，就转换成UTF-8编码。比如用记事本编辑的时候：

![](/assets/0.png)

浏览网页的时候：

![](/assets/2.png)

### 2、python的字符串

对于单个字符编码，python提供了ord\(\)函数获取字符的整数表示，chr\(\)函数把编码转换成对应的字符：

```py
>>> ord('B')
66
>>> chr(100)
'd'
```

如果知道字符的整数编码，还可以用十六进制这么写str:

```py
>>> '\u4e2d\u6587'
'中文'
```

两种写法完全等价的。

由于python的字符串类型是str，在内存中以Unicode表示，一个字符对应若干字节。若要在网络上传输，或保存到磁盘上，就需要把str变为以字节为单位的bytes。

python对于bytes类型的数据用b前缀的单引号或者双引号表示：

```py
x = b'ABC'
```

要注意区分‘ABC’和b'ABC',前者是str，后者内容虽然显示得和前者一样，但是bytes的每个字符都只占用一个字节。

以Unicode表示的str通过encode\(\)方法可以编码为指定的bytes，如：

```py
>>> 'ABC'.encode('ASCII')
b'ABC'
>>> '中文'.encode('UTF-8')
b'\xe4\xb8\xad\xe6\x96\x87'
>>>'中文'.encode('ASCII')
Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)
```

纯英文的str可以用ASCII编码为bytes，内容是一样的；含有中文的str可以用utf-8编码为bytes。但是含有中文的str无法用ASCII编码，因为中文编码的范围超过了ASCII编码的范围，python会报错。

在bytes中，无法显示为ASCII的字节，用\x\#\#来显示。

反过来，如果我们从网络或者磁盘上读取了字节流，那么，读到的数据就是bytes。要把bytes变成str，就需要用decode方法：

```py
>>> b'ABC'.decode('ASCII')
'ABC'
>>> b'\xe4\xb8\xad\xe6\x96\x87'.decode('utf-8')
'中文'
```

要计算str包含多少个字符，可以用len\(\)函数：

```py
>>> len('ABCD')
4
>>> len('我在学习！')
5
```

换成bytes，len\(\)函数就计算bytes的字节数：

```py
>>> len(b'abcd')
4
>>> len(b'\xe4\xb8\xad\xe6\x96\x87')
6
>>>len('中文'.encode('utf-8'))
6
```

操作字符串时，经常遇到str和bytes的相互转换，为了避免乱码问题，应当始终坚持用utf-8编码对str和bytes进行转换。

由于python源代码也是一个文本文件，所以，当你保存你的源代码时，务必指定保存为UTF-8编码。当python解释器读取源代码时，为了让它按UTF-8编码读取，我们通常在文件开头写这两行：

```py
#!/usr/bin/env python3
# -*- codeing
```

第一行注释是为了告诉Linux/OS X系统，这是一个Python可执行程序，Windows系统会忽略这个注释；

第二行注释是为了告诉Python解释器，按照UTF-8编码读取源代码，否则，你在源代码中写的中文输出可能会有乱码。

申明了UTF-8编码并不意味着你的.py文件就是UTF-8编码的，必须并且要确保文本编辑器正在使用UTF-8 without BOM编码：

![](/assets/3.png)

### 3、格式化

最后一个常见问题是

